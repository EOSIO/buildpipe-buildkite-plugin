deploy:
  branch: master
  timezone: US/Eastern
  allowed_hours_regex: '0[9]|1[0-7]'
  allowed_weekdays_regex: '[1-5]'
  blacklist_dates_regex: '\d{4}\-(01\-01|12\-31)'
stairs:
  - name: test
    type: test
    commands:
      - make test
  - name: build
    type: build
    commands:
      - make build
      - make publish-image
    buildkite_override:
      agents:
        - queue=build
  - name: tag
    type: tag
    commands:
      - make tag-release
  - name: deploy-staging
    type: deploy
    commands:
      - make deploy-staging
  - name: deploy-prod
    type: deploy
    commands:
      - make deploy-prod
projects:
  - name: jsproject
    path: js_project
    emoji: ":javascript:"
    skip_stairs:
      - deploy-prod
  - name: pyproject
    path: pyproject
    emoji: ":snake:"
    dependencies:
      - jsproject
